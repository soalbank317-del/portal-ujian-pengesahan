<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portal Ujian Pengesahan KBM</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:'Inter',sans-serif;background:linear-gradient(180deg,#b3e5fc,#fff);display:flex;justify-content:center;align-items:center;min-height:100vh;}
.container{width:95%;max-width:900px;background:#ffffffcc;padding:40px;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,0.1);text-align:center;}
h1{margin:0;font-size:32px;color:#012a4a;}
p{margin:6px 0 20px;color:#555;}
.search-box{position:relative;width:100%;max-width:700px;margin:20px auto;}
.search-box input{width:100%;padding:16px 20px;font-size:18px;border-radius:50px;border:2px solid #03a9f4;outline:none;box-shadow:0 4px 10px rgba(3,169,244,0.1);transition:all 0.2s;}
.search-box input:focus{border-color:#0288d1;box-shadow:0 6px 16px rgba(3,169,244,0.2);}
.results{display:grid;grid-template-columns:1fr;gap:16px;margin-top:20px;}
@media(min-width:600px){.results{grid-template-columns:1fr 1fr;}}
@media(min-width:900px){.results{grid-template-columns:1fr 1fr 1fr;}}
.card{background:#ffffffdd;padding:16px 20px;border-radius:14px;box-shadow:0 4px 16px rgba(0,0,0,0.08);display:flex;flex-direction:column;align-items:flex-start;transition:transform 0.25s,box-shadow 0.25s,opacity 0.3s;opacity:0;transform:translateY(12px);}
.card.show{opacity:1;transform:translateY(0);}
.card:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,0.12);}
.card .mapel{font-weight:700;font-size:18px;color:#012a4a;}
.card .kelas{font-size:14px;color:#555;margin-top:4px;}
.card a{margin-top:8px;display:inline-block;padding:6px 12px;background:#03a9f4;color:#fff;border-radius:8px;text-decoration:none;font-size:14px;}
.card a:hover{background:#0288d1;}
.empty{margin-top:20px;color:#555;font-size:16px;}
mark.hi{background:#fff3b0;color:#2b2b00;padding:0 .15em;border-radius:4px;}
</style>
</head>
<body>
<div class="container">
  <h1>Portal Ujian Pengesahan KBM</h1>
  <p>MTS AMTSILATI - Jl. Kenanga Dk. Sidorejo Ds. Bangsri Jepara 54321</p>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Ketik kelas (7/8/9) atau nama mapel...">
  </div>
  <div id="results" class="results"></div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTGPq9jpsKX5zc9RIsZfEuqLMJ2GrucmiAjzlSezF8oVmA0SZ3-58mekFIFI59GhLiE3vyJ_K0Lx3Zv/pub?output=csv";
let allData = [];

// Parse CSV lebih aman, bisa handle koma di dalam quotes
function parseCSV(text){
  const lines = text.split(/\r?\n/);
  const result=[];
  const headers=lines.shift().split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(h=>h.trim().toLowerCase());
  const iKelas = headers.indexOf("kelas");
  const iMapel = headers.indexOf("mapel");
  const iLink  = headers.indexOf("link");
  lines.forEach(line=>{
    if(!line.trim()) return;
    const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c=>c.replace(/^"|"$/g,'').trim());
    result.push({kelas:cols[iKelas], mapel:cols[iMapel], link:cols[iLink]});
  });
  return result.filter(x=>x.kelas && x.mapel);
}

async function fetchCSV(){
  try{
    const res = await fetch(CSV_URL);
    const text = await res.text();
    allData = parseCSV(text);
  }catch(e){console.error("CSV error",e);}
}

function highlight(text,q){
  if(!q) return text;
  const re=new RegExp(q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'gi');
  return text.replace(re,m=>`<mark class="hi">${m}</mark>`);
}

function renderResults(data,q=""){
  const container=document.getElementById("results");
  container.innerHTML="";
  if(data.length===0){container.innerHTML='<div class="empty">Tidak ada hasil.</div>'; return;}
  data.forEach((item,i)=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <div class="mapel">${highlight(item.mapel,q)}</div>
      <div class="kelas">Kelas ${highlight(item.kelas,q)}</div>
      <a href="${item.link}" target="_blank">Buka Form</a>
    `;
    container.appendChild(div);
    setTimeout(()=>div.classList.add("show"),50+i*80);
  });
}

document.getElementById("searchInput").addEventListener("input",function(){
  const q=this.value.toLowerCase().trim();
  if(!q){document.getElementById("results").innerHTML=""; return;}
  const filtered=allData.filter(x=>x.kelas.toLowerCase().includes(q) || x.mapel.toLowerCase().includes(q));
  renderResults(filtered,q);
});

// fetch CSV saat load
fetchCSV();
</script>
</body>
</html>
